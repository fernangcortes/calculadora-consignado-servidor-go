<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Simulador de Empréstimo Consignado para Servidores do Estado de Goiás</title>

<meta property="og:title" content="Simulador de Empréstimo Consignado para Servidores do Estado de Goiás">
<meta property="og:description" content="Calcule o CET. Simule juros e proteja seu salário. Desenvolvida por um servidor para os servidores do Estado de Goiás.">
<meta property="og:image" content="https://fernangcortes.github.io/calculadora-consignado-servidor-go/preview.png">
<meta property="og:url" content="https://fernangcortes.github.io/calculadora-consignado-servidor-go/">
<meta property="og:type" content="website">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ícones Lucide -->
    <script src="https://unpkg.com/lucide@latest" crossorigin="anonymous"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .fgc-sig { color: #8B0000; font-weight: 800; letter-spacing: 0.05em; }
        
        .custom-checkbox { accent-color: #059669; transform: scale(1.2); }
        .custom-checkbox-blue { accent-color: #2563eb; transform: scale(1.2); }

        .row-selected { 
            background-color: #ecfdf5 !important; 
            border-left: 4px solid #059669 !important; 
        }
        .row-default {
            border-left: 4px solid transparent;
        }

        /* Estilos do Modal */
        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Estilo para impressão */
        @media print {
            .no-print { display: none !important; }
            #tabCalculadora { display: block !important; }
            #tabSites { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-700 pb-20">

    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
        
        <!-- Cabeçalho -->
        <div class="mb-8 flex flex-col md:flex-row justify-between items-end gap-4 no-print">
            <div onmouseenter="setTip('Ferramenta exclusiva para cálculo reverso de consignado com regras estaduais.')" onmouseleave="clearTip()">
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">
                    Custo Efetivo Real <span class="text-emerald-600">Servidor GO</span>
                </h1>
                <p class="mt-2 text-slate-600 max-w-2xl text-sm">
                    Análise estratégica com dados reais de convênios estaduais.
                </p>
            </div>
            
            <!-- Navegação de Abas -->
            <div class="flex bg-slate-200 p-1 rounded-xl gap-1">
                <button onclick="mudarAba('calculadora')" id="btnTabCalc" onmouseenter="setTip('Voltar para a tela de simulação financeira e ranking de bancos.')" onmouseleave="clearTip()" class="px-4 py-2 font-bold rounded-lg transition-colors text-sm flex items-center gap-2 bg-emerald-700 text-white shadow-md">
                    <i data-lucide="calculator" class="w-4 h-4"></i> Calculadora
                </button>
                <button onclick="mudarAba('sites')" id="btnTabSites" onmouseenter="setTip('Acesse leis estaduais, regras do IOF e notícias sobre seus direitos.')" onmouseleave="clearTip()" class="px-4 py-2 font-bold rounded-lg transition-colors text-sm flex items-center gap-2 bg-transparent text-slate-600 hover:bg-white/50">
                    <i data-lucide="link" class="w-4 h-4"></i> Sites Úteis
                </button>
            </div>

            <div class="flex gap-2">
                <button onclick="baixarPrograma()" onmouseenter="setTip('Salva este programa inteiro no seu computador para usar offline.')" onmouseleave="clearTip()" class="flex items-center gap-2 bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm text-sm">
                    <i data-lucide="download" class="w-4 h-4"></i>
                </button>
                <button onclick="gerarOrcamento()" onmouseenter="setTip('Gera relatório detalhado com ranking, mapa de juros e dicas.')" onmouseleave="clearTip()" class="flex items-center gap-2 bg-emerald-700 hover:bg-emerald-800 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-sm text-sm">
                    <i data-lucide="printer" class="w-4 h-4"></i>
                </button>
            </div>
        </div>

        <!-- CONTEÚDO: CALCULADORA -->
        <div id="tabCalculadora" class="fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- Coluna da Esquerda: Inputs -->
                <div class="lg:col-span-4 space-y-6 no-print">
                    
                    <!-- Card de Dados Pessoais (Opcional) -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between cursor-pointer hover:bg-slate-100 transition-colors" onclick="toggleDadosPessoais()" onmouseenter="setTip('Preencha para personalizar o cabeçalho do documento impresso.')" onmouseleave="clearTip()">
                            <div class="flex items-center gap-2">
                                <i data-lucide="user" class="w-5 h-5 text-blue-700"></i>
                                <h2 class="font-bold text-slate-800 text-lg">Dados do Cliente</h2>
                            </div>
                            <i data-lucide="chevron-down" id="iconToggleDados" class="w-4 h-4 text-slate-400 transition-transform"></i>
                        </div>
                        <div id="formDadosPessoais" class="hidden p-6 space-y-4 border-t border-slate-100 bg-slate-50/50">
                            <div onmouseenter="setTip('Nome aparecerá no cabeçalho do orçamento impresso.')" onmouseleave="clearTip()">
                                <label class="text-xs font-bold text-slate-500 uppercase">Nome Completo</label>
                                <input type="text" id="clienteNome" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500 outline-none" placeholder="Ex: João da Silva">
                            </div>
                            <div onmouseenter="setTip('CPF para personalização do documento.')" onmouseleave="clearTip()">
                                <label class="text-xs font-bold text-slate-500 uppercase">CPF</label>
                                <input type="text" id="clienteCPF" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500 outline-none" placeholder="000.000.000-00">
                            </div>
                            <div class="grid grid-cols-1 gap-4">
                                <div onmouseenter="setTip('Email para contato no orçamento.')" onmouseleave="clearTip()">
                                    <label class="text-xs font-bold text-slate-500 uppercase">Email</label>
                                    <input type="email" id="clienteEmail" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500 outline-none" placeholder="email@exemplo.com">
                                </div>
                            </div>
                            <div onmouseenter="setTip('Endereço completo.')" onmouseleave="clearTip()">
                                <label class="text-xs font-bold text-slate-500 uppercase">Endereço</label>
                                <input type="text" id="clienteEndereco" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500 outline-none" placeholder="Rua, Número, Bairro">
                            </div>
                            <p class="text-[10px] text-slate-400 italic text-center">Estes dados são opcionais e aparecem apenas na impressão.</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-2" onmouseenter="setTip('Configure aqui o valor, prazo e condições do seu empréstimo.')" onmouseleave="clearTip()">
                            <i data-lucide="calculator" class="w-5 h-5 text-emerald-700"></i>
                            <h2 class="font-bold text-slate-800 text-lg">Parâmetros</h2>
                        </div>
                        <div class="p-6 space-y-5">
                            
                            <!-- Remuneração Líquida (Design Unificado) -->
                            <div onmouseenter="setTip('Insira seu salário líquido para calcular a margem de 35% disponível.')" onmouseleave="clearTip()">
                                <div class="flex justify-between items-baseline mb-1">
                                    <label class="text-sm font-semibold text-slate-600">Remuneração Líquida</label>
                                    <span id="margemDisplay" class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded">R$&nbsp;1.260,00</span>
                                </div>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium">R$</span>
                                    <input type="number" id="remuneracaoLiquida" value="0" step="100" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 pl-9 transition-colors">
                                </div>
                            </div>

                            <!-- Valor Líquido com Incremento Inteligente (Sem Texto Extra) -->
                            <div onmouseenter="setTip('Use SHIFT para pular de 1000 em 1000, ou CTRL para ajuste fino de 1 em 1.')" onmouseleave="clearTip()">
                                <label class="text-sm font-semibold text-slate-600 block mb-1">Valor Líquido Desejado</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium">R$</span>
                                    <input type="number" id="valorLiquido" value="10000" step="100" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 pl-9 transition-colors">
                                </div>
                            </div>

                            <div onmouseenter="setTip('Prazo máximo em Goiás: 144 meses.')" onmouseleave="clearTip()">
                                <label class="text-sm font-semibold text-slate-600 block mb-1">Prazo (Meses)</label>
                                <div class="relative">
                                    <input type="number" id="prazo" value="96" step="1" max="144" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 pr-12">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium">meses</span>
                                </div>
                                <p class="text-[10px] text-rose-500 mt-1 hidden" id="erroPrazo">Máximo permitido: 144 meses.</p>
                            </div>

                            <div onmouseenter="setTip('Taxa mensal usada para a simulação principal.')" onmouseleave="clearTip()">
                                <label class="text-sm font-semibold text-slate-600 block mb-1">Taxa de Referência (a.m.)</label>
                                <div class="relative">
                                    <input type="number" id="taxaRef" value="1.58" step="0.01" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 pr-8">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium">%</span>
                                </div>
                            </div>

                            <div class="pt-4 border-t border-slate-100 space-y-4">
                                <!-- Checkbox Caixa -->
                                <div onmouseenter="setTip('Atenção: A Caixa reduz a taxa para 1,27% se houver portabilidade de salário.')" onmouseleave="clearTip()">
                                    <label class="flex items-center gap-2 cursor-pointer select-none text-slate-600 font-semibold text-sm">
                                        <input type="checkbox" id="checkCaixa" class="custom-checkbox-blue">
                                        Recebe Salário na Caixa?
                                    </label>
                                    <p class="text-xs text-slate-400 mt-1 pl-6">Habilita taxa especial de 1,27%.</p>
                                </div>

                                <!-- Checkbox Seguro -->
                                <div onmouseenter="setTip('Seguro Prestamista protege a família em caso de morte, mas aumenta o valor financiado.')" onmouseleave="clearTip()">
                                    <label class="flex items-center gap-2 cursor-pointer select-none text-sm font-semibold text-slate-600">
                                        <input type="checkbox" id="checkSeguro" class="custom-checkbox">
                                        Incluir Seguro Prestamista?
                                    </label>
                                    <div id="divSeguroInput" class="hidden mt-3 fade-in">
                                        <div class="relative">
                                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium">R$</span>
                                            <input type="number" id="valorSeguro" value="0" step="10" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-emerald-500 block p-2.5 pl-9">
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Estimado em 5% (editável).</p>
                                    </div>
                                </div>

                                <!-- Checkbox Outras Taxas -->
                                <div onmouseenter="setTip('Adicione outras taxas (ex: TAC, Consultoria) que serão somadas ao saldo devedor.')" onmouseleave="clearTip()">
                                    <label class="flex items-center gap-2 cursor-pointer select-none text-sm font-semibold text-slate-600">
                                        <input type="checkbox" id="checkExtras" class="custom-checkbox-blue">
                                        Incluir Outras Taxas?
                                    </label>
                                    <div id="divExtrasInput" class="hidden mt-3 fade-in space-y-2 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-slate-400">Descrição</label>
                                            <input type="text" id="nomeExtra" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500" placeholder="Ex: Taxa Administrativa">
                                        </div>
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-slate-400">Valor (R$)</label>
                                            <input type="number" id="valorExtra" value="0" step="10" class="w-full bg-white border border-slate-300 rounded p-2 text-sm focus:border-blue-500" placeholder="0,00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="cardDica" class="border-l-4 border-l-green-500 bg-green-50 rounded-lg p-4 fade-in">
                        <div class="flex items-center gap-2 text-green-800 font-bold text-sm mb-1">
                            <i data-lucide="star" class="w-4 h-4"></i> Oportunidade Prazo Curto
                        </div>
                        <p class="text-xs text-green-700">
                            Para prazos de até 60x, a <strong>Servcred</strong> costuma ter taxas muito competitivas (1,36% - 1,58%).
                        </p>
                    </div>
                </div>

                <!-- Coluna da Direita: Resultados -->
                <div class="lg:col-span-8 space-y-6">
                    
                    <!-- Painel de Resultados -->
                    <div class="bg-white rounded-xl shadow-lg border border-emerald-100 ring-4 ring-emerald-50/50 overflow-hidden">
                        <div class="bg-emerald-600 px-6 py-6 text-white">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                <div>
                                    <p class="text-emerald-100 text-sm font-medium mb-1 flex items-center gap-2" onmouseenter="setTip('Valor mensal estimado a ser pago.')" onmouseleave="clearTip()">
                                        Parcela Estimada (Referência)
                                        <span id="badgeBancoSelecionado" class="hidden bg-emerald-800 text-emerald-100 text-[10px] px-2 py-0.5 rounded-full uppercase tracking-wide font-bold shadow-sm"></span>
                                    </p>
                                    <div class="text-4xl font-bold tracking-tight text-slate-800" id="displayParcela">R$&nbsp;500,01</div>
                                    <div id="displayMinMax" class="text-xs text-emerald-200 mt-1 font-medium opacity-90">Min (-0,3%): R$&nbsp;463,11 &nbsp;|&nbsp; Max (+0,3%): R$&nbsp;538,40</div>
                                    
                                    <!-- ALERTA DE MARGEM ESTOURADA -->
                                    <div id="alertaMargem" class="mt-2 bg-rose-700/50 border border-rose-500/50 p-2 rounded text-xs text-rose-100 flex items-center gap-2 hidden">
                                        <i data-lucide="alert-circle" class="w-4 h-4 shrink-0"></i>
                                        <span>Ultrapassa margem de 35%. Reduza o valor ou aumente o prazo.</span>
                                    </div>
                                </div>
                                <div class="bg-emerald-700/50 rounded-lg p-3 text-right" onmouseenter="setTip('Custo Efetivo Total: A taxa real anual que você paga, somando juros + impostos + seguros.')" onmouseleave="clearTip()">
                                    <p class="text-emerald-200 text-xs uppercase font-bold tracking-wider mb-1">CET Total Estimado</p>
                                    <div class="text-2xl font-bold"><span id="displayCet">24,43%</span> <span class="text-sm font-normal text-emerald-300">a.a.</span></div>
                                    <div class="text-xs text-emerald-300 mt-1 font-mono" onmouseenter="setTip('Número total de meses que você ficará pagando esta dívida.')" onmouseleave="clearTip()">
                                        Prazo: <span id="displayPrazoTopo">60</span> meses
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="px-6 py-4 bg-emerald-50 border-b border-emerald-100 flex flex-wrap justify-between text-sm text-emerald-900">
                            <span class="mr-4 mb-2" onmouseenter="setTip('Valor limpo que entra na conta.')" onmouseleave="clearTip()">
                                <strong>Líquido:</strong> <span id="displayLiquido">R$&nbsp;18.084,00</span>
                            </span>
                            <span class="mr-4 mb-2" onmouseenter="setTip('IOF somado ao financiamento.')" onmouseleave="clearTip()">
                                <strong>IOF:</strong> <span id="displayIOF">R$&nbsp;631,27</span>
                                <div id="displayIOFDet" class="text-[10px] text-emerald-600 font-normal">(0,38% Fixo + 2.9930% Diário)</div>
                            </span>
                            <span class="mb-2" onmouseenter="setTip('Soma total de todas as parcelas. Variação mostra cenários com taxas +/- 0.3%')" onmouseleave="clearTip()">
                                <strong>Total Pago:</strong> <span id="displayTotal">R$&nbsp;30.000,88</span>
                                <div id="displayTotalMinMax" class="text-[10px] text-emerald-600 font-normal mt-0.5">Min: R$&nbsp;27.786,74 | Max: R$&nbsp;32.304,01</div>
                            </span>
                        </div>

                        <div class="px-6 py-3 bg-white flex justify-between items-center text-sm border-t border-slate-100">
                            <div class="flex items-center gap-2 text-rose-700 font-bold" onmouseenter="setTip('Dinheiro pago apenas em juros (aluguel do dinheiro).')" onmouseleave="clearTip()">
                                <i data-lucide="trending-up" class="w-4 h-4"></i>
                                Custo Total de Juros: <span id="displayJurosTotal">R$&nbsp;11.285,61</span>
                            </div>
                            <div class="text-xs text-slate-500 font-medium bg-slate-100 px-2 py-1 rounded" onmouseenter="setTip('Porcentagem do total pago que corresponde apenas a juros.')" onmouseleave="clearTip()">
                                Impacto: <span id="displayJurosPerc">37,62% do total</span> do contrato
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Bancos -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden no-print">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-2" onmouseenter="setTip('Lista comparativa ordenada da menor para a maior taxa (Custo Efetivo).')" onmouseleave="clearTip()">
                            <i data-lucide="building" class="w-5 h-5 text-blue-700"></i>
                            <h2 class="font-bold text-slate-800 text-lg">Ranking de Oportunidades (Goiás)</h2>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-slate-600">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-50 border-b border-slate-200">
                                    <tr>
                                        <th class="px-4 py-3">Instituição</th>
                                        <th class="px-4 py-3 text-center">Taxa</th>
                                        <th class="px-4 py-3 text-center">Parcela</th>
                                        <th class="px-4 py-3 text-right">CET Real</th>
                                        <th class="px-4 py-3 text-center">Contato</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaBancos">
                                    <!-- Preenchido via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Dicas e Cuidados Essenciais (Site) -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden no-print">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-2" onmouseenter="setTip('Orientações de segurança financeira para evitar endividamento.')" onmouseleave="clearTip()">
                            <i data-lucide="shield-check" class="w-5 h-5 text-emerald-700"></i>
                            <h2 class="font-bold text-slate-800 text-lg">Dicas e Cuidados Essenciais</h2>
                        </div>
                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-slate-600">
                            
                            <!-- Card Troco -->
                            <div class="p-3 bg-amber-50 border border-amber-100 rounded-lg relative group">
                                <strong class="block text-amber-800 mb-1 flex items-center gap-1"><i data-lucide="alert-triangle" class="w-3 h-3"></i> Cuidado com o "Troco"</strong>
                                Refinanciar para pegar um valor pequeno muitas vezes reinicia sua dívida para a parcela nº 1.
                                <button onclick="abrirModal('troco')" class="mt-2 text-[10px] font-bold text-amber-700 hover:text-amber-900 underline flex items-center gap-1 cursor-pointer">
                                    Saiba mais...
                                </button>
                            </div>

                            <!-- Card Portabilidade -->
                            <div class="p-3 bg-emerald-50 border border-emerald-100 rounded-lg">
                                <strong class="block text-emerald-800 mb-1 flex items-center gap-1"><i data-lucide="check-circle" class="w-3 h-3"></i> Portabilidade</strong>
                                Se encontrar taxa menor, peça portabilidade. Você <strong>não paga IOF</strong> novamente sobre o saldo portado.
                                <button onclick="abrirModal('portabilidade')" class="mt-2 text-[10px] font-bold text-emerald-700 hover:text-emerald-900 underline flex items-center gap-1 cursor-pointer">
                                    Saiba mais...
                                </button>
                            </div>
                            
                            <!-- Card do Sindicato com Link -->
                            <div class="p-3 bg-blue-50 border border-blue-100 rounded-lg md:col-span-2">
                                <strong class="block text-blue-800 mb-1 flex items-center gap-1"><i data-lucide="users" class="w-3 h-3"></i> Consulte seu Sindicato</strong>
                                Visite seu sindicato antes de contratar. Eles oferecem transparência, conferem margem e possuem convênios éticos.
                                <div class="flex items-center gap-4 mt-1">
                                    <a href="https://sindipublico.org.br/" target="_blank" class="text-blue-600 font-bold underline hover:text-blue-800" onmouseenter="setTip('https://sindipublico.org.br/')" onmouseleave="clearTip()">Acesse: sindipublico.org.br</a>
                                    <button onclick="abrirModal('sindicato')" class="text-[10px] font-bold text-blue-700 hover:text-blue-900 underline flex items-center gap-1 cursor-pointer">
                                        Saiba mais...
                                    </button>
                                </div>
                            </div>

                            <!-- Card Seguro -->
                            <div class="p-3 bg-slate-50 border border-slate-200 rounded-lg">
                                <strong class="block text-slate-800 mb-1 flex items-center gap-1"><i data-lucide="shield" class="w-3 h-3"></i> Seguro Prestamista</strong>
                                Protege a família quitando a dívida em caso de falecimento, mas encarece a parcela. Verifique se é opcional.
                                <button onclick="abrirModal('seguro')" class="mt-2 text-[10px] font-bold text-slate-700 hover:text-slate-900 underline flex items-center gap-1 cursor-pointer">
                                    Saiba mais...
                                </button>
                            </div>

                            <!-- Card Prazo -->
                            <div class="p-3 bg-rose-50 border border-rose-100 rounded-lg">
                                <strong class="block text-rose-800 mb-1 flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i> Prazo 144 Meses</strong>
                                Parcelas menores, mas o juro composto é brutal. Você pode pagar 3x o valor original. Evite se possível.
                                <button onclick="abrirModal('prazo')" class="mt-2 text-[10px] font-bold text-rose-700 hover:text-rose-900 underline flex items-center gap-1 cursor-pointer">
                                    Saiba mais...
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- CONTEÚDO: SITES ÚTEIS -->
        <div id="tabSites" class="fade-in no-print hidden">
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center gap-2" onmouseenter="setTip('Links externos para fontes oficiais e legislação.')" onmouseleave="clearTip()">
                    <i data-lucide="link" class="w-5 h-5 text-blue-700"></i>
                    <h2 class="font-bold text-slate-800 text-lg">Links e Referências Importantes</h2>
                </div>
                <div id="sitesContent" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Preenchido via JS -->
                </div>
            </div>
        </div>

    </div>

    <!-- Rodapé Interativo -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 h-10 flex justify-between items-center text-xs">
           <div class="flex items-center gap-2 text-slate-600 font-medium truncate max-w-[70%] md:max-w-none">
              <span id="footerText" class="flex items-center gap-2 text-slate-400 italic"><i data-lucide="info" class="w-3.5 h-3.5"></i> Passe o mouse para ver dicas...</span>
           </div>
           
           <div class="text-slate-400 font-medium pl-4 border-l border-slate-100 text-right leading-tight">
              <div>desenvolvido por <span class="fgc-sig">FGC</span></div>
              <div class="text-[9px] opacity-80">fernandocortes@ueg.br</div>
           </div>
        </div>
    </footer>

    <!-- MODAL DE DICAS -->
    <div id="modalDica" class="modal-overlay fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden fade-in relative">
            <div id="modalHeader" class="px-6 py-4 border-b flex justify-between items-center">
                <h3 id="modalTitle" class="font-bold text-lg flex items-center gap-2"></h3>
                <button onclick="fecharModal()" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6 modal-content text-sm text-slate-600 leading-relaxed" id="modalBody">
                <!-- Conteúdo Injetado -->
            </div>
            <div class="bg-slate-50 px-6 py-3 border-t border-slate-100 flex justify-end">
                <button onclick="fecharModal()" class="px-4 py-2 bg-slate-800 text-white text-xs font-bold rounded hover:bg-slate-900">
                    Entendi
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts da Lógica -->
    <script>
        // --- ESTADO GLOBAL ---
        let selectedBankId = null;

        // --- INFO DETALHADA DAS DICAS (MODAL) ---
        const DICAS_INFO = {
            troco: {
                titulo: 'Cuidado com o "Troco" (Refinanciamento)',
                cor: 'amber',
                icon: 'alert-triangle',
                texto: `
                    <p class="mb-3"><strong>O que é:</strong> Quando você já pagou uma parte do seu empréstimo (ex: 30 de 96 parcelas), o banco oferece "zerar" sua dívida antiga e te dar um dinheiro extra na mão (o troco), mas reiniciando o contrato para 96 meses novamente.</p>
                    <p class="mb-3"><strong>A Armadilha:</strong> Ao aceitar o troco, você joga fora todo o tempo que já pagou. Você volta para a estaca zero. O valor que você recebe de troco geralmente custa muito caro no longo prazo.</p>
                    <p><strong>Exemplo Real:</strong> Faltam R$ 20.000 para quitar. O banco te dá R$ 3.000 de troco e renova a dívida para R$ 23.000 em 96x. No final, esses R$ 3.000 extras podem custar R$ 10.000 em juros adicionais.</p>
                `
            },
            portabilidade: {
                titulo: 'Portabilidade de Crédito',
                cor: 'emerald',
                icon: 'check-circle',
                texto: `
                    <p class="mb-3"><strong>Seu Direito:</strong> A portabilidade é a transferência da sua dívida de um banco caro para outro com juros menores. É um direito garantido pelo Banco Central.</p>
                    <p class="mb-3"><strong>Vantagem do IOF:</strong> Diferente de um novo empréstimo, na portabilidade pura (sem troco), <strong>não há cobrança de IOF</strong> sobre o saldo devedor que foi transferido. Isso gera uma economia imediata.</p>
                    <p><strong>Como fazer:</strong> Solicite ao novo banco. Eles quitam a dívida com o banco antigo. O banco antigo é obrigado a fornecer o saldo devedor e não pode negar a portabilidade.</p>
                `
            },
            sindicato: {
                titulo: 'A Importância do Sindicato',
                cor: 'blue',
                icon: 'users',
                texto: `
                    <p class="mb-3"><strong>Defesa Coletiva:</strong> O Sindipúblico atua fiscalizando os convênios firmados pelo Estado, garantindo que as taxas aplicadas respeitem os contratos.</p>
                    <p class="mb-3"><strong>Serviços:</strong> Muitos sindicatos possuem departamentos jurídicos para analisar contratos abusivos e conferir se a margem consignável foi calculada corretamente.</p>
                    <p><strong>Transparência:</strong> Antes de assinar qualquer contrato, visite o site ou a sede do sindicato. Eles podem ter tabelas comparativas atualizadas e alertar sobre golpes recentes no mercado.</p>
                    <p style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cbd5e1;">
                       <a href="https://sindipublico.org.br/" target="_blank" style="color:#2563eb; font-weight:bold; text-decoration:underline;">Acesse o site oficial: https://sindipublico.org.br/</a>
                    </p>
                `
            },
            seguro: {
                titulo: 'Seguro Prestamista',
                cor: 'slate',
                icon: 'shield',
                texto: `
                    <p class="mb-3"><strong>Para que serve:</strong> Garante a quitação (total ou parcial) da dívida em caso de morte ou invalidez do servidor. Evita que a dívida recaia sobre o espólio (herança).</p>
                    <p class="mb-3"><strong>Venda Casada (Ilegal):</strong> O banco não pode OBRIGAR você a contratar o seguro. Ele deve ser opcional. Se foi incluído sem seu consentimento, é venda casada.</p>
                    <p><strong>Direito de Arrependimento:</strong> Você pode cancelar o seguro a qualquer momento e pedir a devolução proporcional do valor pago pelo tempo que não utilizou (conforme regras da SUSEP).</p>
                `
            },
            prazo: {
                titulo: 'Perigo do Prazo Longo (144x)',
                cor: 'rose',
                icon: 'calendar',
                texto: `
                    <p class="mb-3"><strong>Matemática Cruel:</strong> O consignado em Goiás permite até 144 meses (12 anos). Embora a parcela mensal fique menor, o tempo joga contra você.</p>
                    <p class="mb-3"><strong>Juros Compostos:</strong> Quanto maior o tempo, mais os juros incidem sobre juros. Em um contrato de 144x, é comum pagar 3 vezes o valor que você pegou emprestado.</p>
                    <p><strong>Recomendação:</strong> Tente manter o prazo entre 60 e 96 meses. A parcela será um pouco maior, mas a economia total no final do contrato será de milhares de reais.</p>
                `
            }
        };

        // --- DADOS DOS SITES ---
        const SITES_DATA = [
            {
                categoria: "IOF e Juros",
                icon: "percent",
                links: [
                    { t: "Mudanças no IOF 2025 - C6", d: "Explica as alterações no IOF em 2025 e revogações.", u: "https://www.c6bank.com.br/blog/mudancas-no-iof-2025" },
                    { t: "IOF 2025 - Santander", d: "Detalhamento das novas regras do IOF para operações.", u: "https://www.santander.com.br/blog/mudancas-iof" },
                    { t: "Taxas Anuais - Bacen", d: "Estatísticas oficiais de juros por modalidade.", u: "https://www.bcb.gov.br/estatisticas/reporttxjuros/?codigoSegmento=1&codigoModalidade=220101" },
                    { t: "Selic e cálculo de juros", d: "Ferramenta da Receita Federal.", u: "https://sicalc.receita.fazenda.gov.br/sicalc/selic/consulta" },
                    { t: "Teto consignado: 1,80%", d: "CNPS eleva teto de juros para 1,80% ao mês.", u: "https://www.gov.br/previdencia/pt-br/noticias/2025/janeiro/taxa-maxima-de-juros-do-consignado-sobe-para-1-80-ao-mes" }
                ]
            },
            {
                categoria: "Empréstimo Consignado",
                icon: "credit-card",
                links: [
                    { t: "Prazo maior (Goiás)", d: "Governo amplia prazo para 144 meses.", u: "https://goias.gov.br/governo-aumenta-tempo-de-contratacao-de-consignados/" },
                    { t: "Tabela de Juros 2026", d: "Comparativo de taxas para 2026.", u: "https://meutudo.com.br/blog/tabelas/emprestimo-consignado/" },
                    { t: "Taxas Sead GO", d: "Tabela oficial de bancos credenciados em GO.", u: "https://goias.gov.br/administracao/tabela-de-taxas-para-emprestimo-consignado/" }
                ]
            },
            {
                categoria: "Legislação Estadual",
                icon: "scroll-text",
                links: [
                    { t: "Lei 23.246/2025 - GO", d: "Altera normas sobre consignações em folha.", u: "https://legisla.casacivil.go.gov.br/pesquisa_legislacao/110412/lei-23246" },
                    { t: "Decreto 10.372/2023", d: "Regulamenta procedimentos administrativos.", u: "https://legisla.casacivil.go.gov.br/pesquisa_legislacao/108286/decreto-10372" },
                    { t: "Decreto 1.587/2019", d: "Normas para servidores de Goiânia.", u: "https://www.goiania.go.gov.br/html/gabinete_civil/sileg/dados/legis/2019/dc_20190619_000001587.html" }
                ]
            },
            {
                categoria: "Direitos do Consumidor",
                icon: "scale",
                links: [
                    { t: "Venda casada é ilegal", d: "Artigo sobre ilegalidade do seguro imposto.", u: "https://www.barbieriadvogados.com/venda-casada-prestamista-consignado/" },
                    { t: "TAC e TEC são ilegais", d: "Jurisprudência TJDFT sobre tarifas.", u: "https://www.tjdft.jus.br/consultas/jurisprudencia/jurisprudencia-em-temas/jurisprudencia-em-detalhes/acao-revisional-de-contrato-bancario/tarifa-de-abertura-de-credito-tac-e-tarifa-de-emissao-de-carne-tec" },
                    { t: "Reajuste de 4,83%", d: "Aprovado para servidores do Executivo GO.", u: "https://portal.al.go.leg.br/noticias/151164/data-base-de-4-83-para-servidores-publicos-do-poder-executivo-passa-em-segunda-votacao" }
                ]
            }
        ];

        // --- DADOS DOS BANCOS ---
        const BANCOS_DATA = [
            { id: 'alfa', nome: 'Financeira Alfa', taxaBase: 1.26, tags: [{t:'Melhor Cenário', c:'green'}], obs: 'Exige Score Alto.', 
              links: { site: 'https://www.financeiraalfa.com.br/', map: 'Financeira+Alfa+Goiania', tel: '4004-0001', email: 'sac@financeiraalfa.com.br' } },
            
            { id: 'caixa', nome: 'Caixa Econômica', taxaBase: 1.58, taxaPromo: 1.27, tags: [{t:'Taxa Imbatível', c:'blue'}], obs: 'Com portabilidade.', 
              links: { site: 'https://www.caixa.gov.br', map: 'Caixa+Economica+Federal+Goiania', tel: '4004-0104', email: 'faleconosco@caixa.gov.br' } },
            
            { id: 'servcred', nome: 'Servcred/GO', taxaBase: 1.36, tags: [{t:'Regional', c:'gray'}], obs: 'Ótima p/ prazo curto.', 
              links: { site: 'https://www.servcred.com.br', map: 'Servcred+Goiania', tel: '(62) 3213-0000', email: 'contato@servcred.com.br' } },
            
            { id: 'bb', nome: 'Banco do Brasil', taxaBase: 1.71, tags: [{t:'App Fácil', c:'blue'}], obs: 'Correntistas.', 
              links: { site: 'https://www.bb.com.br', map: 'Banco+do+Brasil+Goiania', tel: '4004-0001', email: 'bbconsignado@bb.com.br' } },
            
            { id: 'pan', nome: 'Banco Pan', taxaBase: 2.02, tags: [{t:'Refinanciamento', c:'yellow'}], obs: 'Médio score.', 
              links: { site: 'https://www.bancopan.com.br', map: 'Banco+Pan+Goiania', tel: '4004-4828', email: 'atendimento@bancopan.com.br' } },
            
            { id: 'itau', nome: 'Itaú Unibanco', taxaBase: 2.24, tags: [{t:'Varejo', c:'gray'}], obs: 'Relacionamento.', 
              links: { site: 'https://www.itau.com.br', map: 'Itau+Goiania', tel: '4004-4828', email: 'atendimento@itau.com.br' } },
            
            { id: 'bmg', nome: 'BMG / Daycoval', taxaBase: 2.34, tags: [{t:'Negativado', c:'green'}], obs: 'Perfil de risco.', 
              links: { site: 'https://www.bancobmg.com.br', map: 'Banco+BMG+Goiania', tel: '0800 979 9099', email: 'suporte@bancobmg.com.br' } }
        ];

        // --- Motores de Cálculo ---
        function calculatePMT(principal, rateDecimal, months) {
            if (rateDecimal === 0) return principal / months;
            return principal * (rateDecimal * Math.pow(1 + rateDecimal, months)) / (Math.pow(1 + rateDecimal, months) - 1);
        }

        function calculateCET(netReceived, pmt, months) {
            let min = 0, max = 1.0, guess = 0.05;
            for (let i = 0; i < 50; i++) {
                guess = (min + max) / 2;
                let npv = 0;
                for (let t = 1; t <= months; t++) npv += pmt / Math.pow(1 + guess, t);
                if (Math.abs(npv - netReceived) < 0.01) break;
                if (npv > netReceived) min = guess; else max = guess;
            }
            return guess;
        }

        const fMoney = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        const fPercent = (v) => v.toLocaleString('pt-BR', { style: 'percent', minimumFractionDigits: 2 });

        function mudarAba(aba) {
            const tabCalc = document.getElementById('tabCalculadora');
            const tabSites = document.getElementById('tabSites');
            const btnCalc = document.getElementById('btnTabCalc');
            const btnSites = document.getElementById('btnTabSites');

            if (aba === 'calculadora') {
                tabCalc.classList.remove('hidden');
                tabSites.classList.add('hidden');
                
                btnCalc.classList.remove('bg-transparent', 'text-slate-600', 'hover:bg-white/50');
                btnCalc.classList.add('bg-emerald-700', 'text-white', 'shadow-md');
                
                btnSites.classList.add('bg-transparent', 'text-slate-600', 'hover:bg-white/50');
                btnSites.classList.remove('bg-emerald-700', 'text-white', 'shadow-md');
            } else {
                tabCalc.classList.add('hidden');
                tabSites.classList.remove('hidden');
                
                btnSites.classList.remove('bg-transparent', 'text-slate-600', 'hover:bg-white/50');
                btnSites.classList.add('bg-emerald-700', 'text-white', 'shadow-md');
                
                btnCalc.classList.add('bg-transparent', 'text-slate-600', 'hover:bg-white/50');
                btnCalc.classList.remove('bg-emerald-700', 'text-white', 'shadow-md');
            }
        }

        function renderSites() {
            const container = document.getElementById('sitesContent');
            // Card Especial do Sindipublico
            let html = `
                <div class="border-2 border-yellow-400 rounded-lg p-4 bg-yellow-50 shadow-sm md:col-span-2 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-2 py-1 rounded-bl">DESTAQUE</div>
                    <div class="flex items-center gap-2 mb-2 text-yellow-900 font-bold">
                        <i data-lucide="star" class="w-5 h-5 fill-yellow-500 text-yellow-600"></i>
                        Sindipúblico Goiás
                    </div>
                    <p class="text-sm text-yellow-800 mb-3">Acesse o portal oficial do sindicato para conferir convênios exclusivos, notícias da categoria e suporte jurídico.</p>
                    <a href="https://sindipublico.org.br/" target="_blank" class="inline-flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded text-sm transition-colors shadow"
                       onmouseenter="setTip('https://sindipublico.org.br/')" onmouseleave="clearTip()">
                        Acessar Portal Oficial <i data-lucide="external-link" class="w-4 h-4"></i>
                    </a>
                </div>
            `;

            html += SITES_DATA.map(cat => `
                <div class="border border-slate-200 rounded-lg p-4 bg-slate-50">
                    <div class="flex items-center gap-2 mb-3 text-emerald-800 font-bold border-b border-slate-200 pb-2"
                         onmouseenter="setTip('Categoria de links úteis.')" onmouseleave="clearTip()">
                        <i data-lucide="${cat.icon}" class="w-5 h-5"></i>
                        ${cat.categoria}
                    </div>
                    <ul class="space-y-3">
                        ${cat.links.map(l => `
                            <li>
                                <a href="${l.u}" target="_blank" class="block group"
                                   onmouseenter="setTip('${l.u}')" onmouseleave="clearTip()">
                                    <div class="text-sm font-semibold text-blue-700 group-hover:text-blue-900 group-hover:underline flex items-center gap-1">
                                        ${l.t} <i data-lucide="external-link" class="w-3 h-3 opacity-50"></i>
                                    </div>
                                    <div class="text-xs text-slate-500 mt-0.5">${l.d}</div>
                                </a>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Funções do Modal
        function abrirModal(tipo) {
            const data = DICAS_INFO[tipo];
            if (!data) return;

            // Configurar Cores e Ícones
            const colors = {
                amber: { border: 'border-amber-500', text: 'text-amber-700', bgIcon: 'bg-amber-100' },
                emerald: { border: 'border-emerald-500', text: 'text-emerald-700', bgIcon: 'bg-emerald-100' },
                blue: { border: 'border-blue-500', text: 'text-blue-700', bgIcon: 'bg-blue-100' },
                slate: { border: 'border-slate-500', text: 'text-slate-700', bgIcon: 'bg-slate-100' },
                rose: { border: 'border-rose-500', text: 'text-rose-700', bgIcon: 'bg-rose-100' }
            };
            const theme = colors[data.cor];

            const header = document.getElementById('modalHeader');
            header.className = `px-6 py-4 border-b ${theme.border} border-opacity-20 flex justify-between items-center bg-white`;
            
            const title = document.getElementById('modalTitle');
            title.className = `font-bold text-lg flex items-center gap-2 ${theme.text}`;
            title.innerHTML = `<div class="p-2 rounded-full ${theme.bgIcon}"><i data-lucide="${data.icon}" class="w-5 h-5"></i></div> ${data.titulo}`;

            document.getElementById('modalBody').innerHTML = data.texto;
            
            document.getElementById('modalDica').classList.remove('hidden');
            lucide.createIcons();
        }

        function fecharModal() {
            document.getElementById('modalDica').classList.add('hidden');
        }

        // Fechar ao clicar fora
        document.getElementById('modalDica').addEventListener('click', (e) => {
            if (e.target.id === 'modalDica') fecharModal();
        });

        function toggleDadosPessoais() {
            const form = document.getElementById('formDadosPessoais');
            const icon = document.getElementById('iconToggleDados');
            form.classList.toggle('hidden');
            if (form.classList.contains('hidden')) {
                icon.style.transform = 'rotate(0deg)';
            } else {
                icon.style.transform = 'rotate(180deg)';
            }
        }

        function update() {
            const valorLiquido = parseFloat(document.getElementById('valorLiquido').value) || 0;
            const prazo = parseInt(document.getElementById('prazo').value) || 1;
            const taxaRef = parseFloat(document.getElementById('taxaRef').value) || 0;
            const recebeCaixa = document.getElementById('checkCaixa').checked;
            const usaSeguro = document.getElementById('checkSeguro').checked;
            const usaExtras = document.getElementById('checkExtras').checked;
            
            const divSeguro = document.getElementById('divSeguroInput');
            let valorSeguro = 0;
            if (usaSeguro) {
                divSeguro.classList.remove('hidden');
                valorSeguro = parseFloat(document.getElementById('valorSeguro').value) || 0;
            } else {
                divSeguro.classList.add('hidden');
            }

            const divExtras = document.getElementById('divExtrasInput');
            let valorExtra = 0;
            if (usaExtras) {
                divExtras.classList.remove('hidden');
                valorExtra = parseFloat(document.getElementById('valorExtra').value) || 0;
            } else {
                divExtras.classList.add('hidden');
            }

            const cardDica = document.getElementById('cardDica');
            if (prazo <= 60) cardDica.classList.remove('hidden'); else cardDica.classList.add('hidden');

            // Cálculos
            const prazoDias = prazo * 30;
            const aliqFixo = 0.0038;
            const aliqDiaria = 0.000082 * Math.min(prazoDias, 365);
            const iofTotal = aliqFixo + aliqDiaria;
            
            const financiadoBruto = (valorLiquido + valorSeguro + valorExtra) / (1 - iofTotal);
            const valorIOF = financiadoBruto - (valorLiquido + valorSeguro + valorExtra);
            
            const i = taxaRef / 100;
            const pmt = calculatePMT(financiadoBruto, i, prazo);
            const cetMensal = calculateCET(valorLiquido, pmt, prazo);
            const cetAnual = Math.pow(1 + cetMensal, 12) - 1;
            
            // Juros Totais
            const totalPago = pmt * prazo;
            const totalJuros = totalPago - financiadoBruto;
            const percJuros = totalPago > 0 ? (totalJuros / totalPago) : 0;

            const taxaMin = Math.max(0, taxaRef - 0.3);
            const taxaMax = taxaRef + 0.3;
            const pmtMin = calculatePMT(financiadoBruto, taxaMin/100, prazo);
            const pmtMax = calculatePMT(financiadoBruto, taxaMax/100, prazo);
            const totalMin = pmtMin * prazo;
            const totalMax = pmtMax * prazo;

            // UI Updates
            const displayParcela = document.getElementById('displayParcela');
            const alertaMargem = document.getElementById('alertaMargem');
            const remunLiq = parseFloat(document.getElementById('remuneracaoLiquida').value) || 0;
            const margem35 = remunLiq * 0.35;
            document.getElementById('margemDisplay').innerText = fMoney(margem35);

            displayParcela.innerText = fMoney(pmt);
            
            if (remunLiq > 0 && pmt > margem35) {
                displayParcela.classList.remove('text-slate-800');
                displayParcela.classList.add('text-rose-600');
                alertaMargem.classList.remove('hidden');
            } else {
                displayParcela.classList.remove('text-rose-600');
                displayParcela.classList.add('text-slate-800');
                alertaMargem.classList.add('hidden');
            }

            document.getElementById('displayCet').innerText = fPercent(cetAnual);
            document.getElementById('displayLiquido').innerText = fMoney(valorLiquido);
            document.getElementById('displayIOF').innerText = fMoney(valorIOF);
            document.getElementById('displayIOFDet').innerText = `(0,38% Fixo + ${(aliqDiaria*100).toFixed(4)}% Diário)`;
            document.getElementById('displayTotal').innerText = fMoney(totalPago);
            document.getElementById('displayTotalMinMax').innerText = `Min: ${fMoney(totalMin)} | Max: ${fMoney(totalMax)}`;
            document.getElementById('displayPrazoTopo').innerText = prazo;
            
            document.getElementById('displayJurosTotal').innerText = fMoney(totalJuros);
            document.getElementById('displayJurosPerc').innerText = fPercent(percJuros) + " do total";

            const badge = document.getElementById('badgeBancoSelecionado');
            if (selectedBankId) {
                const banco = BANCOS_DATA.find(b => b.id === selectedBankId);
                if (banco) {
                    badge.innerText = banco.nome;
                    badge.classList.remove('hidden');
                }
            } else {
                badge.classList.add('hidden');
            }

            const minMaxDiv = document.getElementById('displayMinMax');
            minMaxDiv.innerHTML = `Min (-0,3%): ${fMoney(pmtMin)} &nbsp;|&nbsp; Max (+0,3%): ${fMoney(pmtMax)}`;
            minMaxDiv.classList.remove('hidden');

            // Tabela
            const tbody = document.getElementById('tabelaBancos');
            tbody.innerHTML = '';

            const bancosCalculados = BANCOS_DATA.map(b => {
                let taxa = b.taxaBase;
                if (b.id === 'caixa' && recebeCaixa) taxa = b.taxaPromo;
                const pmtBanco = calculatePMT(financiadoBruto, taxa/100, prazo);
                const cetBanco = calculateCET(valorLiquido, pmtBanco, prazo) * 100;
                let tags = [...b.tags];
                if (b.id === 'servcred' && prazo <= 60) tags.unshift({t:'Ótimo p/ Prazo Curto', c:'green'});
                return { ...b, taxa, tags, pmt: pmtBanco, total: pmtBanco * prazo, cet: cetBanco };
            }).sort((a,b) => a.cet - b.cet);

            bancosCalculados.forEach((b, idx) => {
                const tr = document.createElement('tr');
                if (b.id === selectedBankId) {
                    tr.className = "row-selected cursor-pointer transition-colors";
                } else {
                    tr.className = "row-default bg-white border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors";
                }

                tr.onclick = () => { 
                    selectedBankId = b.id; 
                    document.getElementById('taxaRef').value = b.taxa; 
                    update(); 
                };
                
                tr.onmouseenter = () => setTip(`Dica: ${b.obs}`);
                tr.onmouseleave = clearTip;

                const badgesHtml = b.tags.map(tag => {
                    const colors = { green: 'bg-emerald-100 text-emerald-800', blue: 'bg-blue-100 text-blue-800', yellow: 'bg-amber-100 text-amber-800', gray: 'bg-slate-100 text-slate-800' };
                    return `<span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase ${colors[tag.c] || colors.gray} mr-1 mb-1">${tag.t}</span>`;
                }).join('');

                const checkIcon = b.id === selectedBankId ? '<i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-600 inline mr-1"></i>' : '';
                const melhor = idx === 0 ? '<span class="bg-emerald-600 text-white text-[9px] px-1.5 py-0.5 rounded font-bold uppercase ml-2">Melhor</span>' : '';

                tr.innerHTML = `
                    <td class="px-4 py-3">
                        <div class="font-bold text-slate-900 flex items-center">${checkIcon} ${b.nome} ${melhor}</div>
                        <div class="mt-1">${badgesHtml}</div>
                    </td>
                    <td class="px-4 py-3 text-center">${b.taxa.toFixed(2)}%</td>
                    <td class="px-4 py-3 text-center text-slate-800 font-bold">${fMoney(b.pmt)}</td>
                    <td class="px-4 py-3 text-right text-rose-700 font-bold">${b.cet.toFixed(2)}%</td>
                    <td class="px-4 py-3 text-center">
                        <div class="flex items-center justify-center gap-1.5">
                            <a href="tel:${b.links.tel}" class="p-1.5 bg-slate-100 hover:bg-indigo-100 text-indigo-600 rounded-full" title="Ligar" onclick="event.stopPropagation()" onmouseenter="setTip('Ligue para ${b.nome}: ${b.links.tel}')" onmouseleave="clearTip()">
                                <i data-lucide="phone" class="w-3.5 h-3.5"></i>
                            </a>
                            <a href="mailto:${b.links.email}" class="p-1.5 bg-slate-100 hover:bg-orange-100 text-orange-600 rounded-full" title="Email" onclick="event.stopPropagation()" onmouseenter="setTip('Email: ${b.links.email}')" onmouseleave="clearTip()">
                                <i data-lucide="mail" class="w-3.5 h-3.5"></i>
                            </a>
                            <a href="${b.links.site}" target="_blank" class="p-1.5 bg-slate-100 hover:bg-blue-100 text-blue-600 rounded-full" title="Site Oficial" onclick="event.stopPropagation()" onmouseenter="setTip('Visite o site oficial')" onmouseleave="clearTip()">
                                <i data-lucide="globe" class="w-3.5 h-3.5"></i>
                            </a>
                            <a href="https://www.google.com/maps/search/${b.links.map}" target="_blank" class="p-1.5 bg-slate-100 hover:bg-emerald-100 text-emerald-600 rounded-full" title="Mapa" onclick="event.stopPropagation()" onmouseenter="setTip('Ver agências em Goiânia')" onmouseleave="clearTip()">
                                <i data-lucide="map-pin" class="w-3.5 h-3.5"></i>
                            </a>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            lucide.createIcons();
        }

        function setTip(text) {
            document.getElementById('footerText').innerHTML = `<span class="flex items-center gap-2 text-blue-700 fade-in"><i data-lucide="info" class="w-3.5 h-3.5"></i> ${text}</span>`;
            lucide.createIcons();
        }
        function clearTip() {
            document.getElementById('footerText').innerHTML = `<span class="flex items-center gap-2 text-slate-400 italic"><i data-lucide="help-circle" class="w-3.5 h-3.5"></i> Passe o mouse para ver dicas...</span>`;
            lucide.createIcons();
        }

        // --- CORREÇÃO: Função Baixar Programa ---
        // Adicionada detecção de celular para evitar frustração do usuário
        function baixarPrograma() {
            // Verifica se é mobile (Android, iPhone, etc)
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                alert("Atenção: A função de baixar o programa executável (.html) funciona melhor em computadores.\n\nNo celular, utilize o botão 'Imprimir' (ao lado) para Salvar como PDF.");
                return;
            }

            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Calculadora_Consignado_FGC.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // --- CORREÇÃO: Função Gerar Orçamento ---
        // Alterado para usar IFRAME oculto em vez de window.open
        // Isso resolve o bloqueio de popups em celulares e permite salvar como PDF
        function gerarOrcamento() {
            const valorRaw = parseFloat(document.getElementById('valorLiquido').value);
            const valor = fMoney(valorRaw);
            const prazo = parseInt(document.getElementById('prazo').value);
            const taxaRef = parseFloat(document.getElementById('taxaRef').value);
            const dataHoje = new Date().toLocaleDateString('pt-BR');
            const dataFile = dataHoje.replace(/\//g, '-');
            const recebeCaixa = document.getElementById('checkCaixa').checked;
            const usaSeguro = document.getElementById('checkSeguro').checked;
            const valorSeguro = usaSeguro ? parseFloat(document.getElementById('valorSeguro').value) : 0;
            const usaExtras = document.getElementById('checkExtras').checked;
            const valorExtra = usaExtras ? parseFloat(document.getElementById('valorExtra').value) : 0;
            const nomeExtra = usaExtras ? (document.getElementById('nomeExtra').value || "Outras Taxas") : "Outras Taxas";
            
            // Dados de Margem
            const remunLiq = parseFloat(document.getElementById('remuneracaoLiquida').value) || 0;
            const margem35 = remunLiq * 0.35;

            // Dados Pessoais
            const cNome = document.getElementById('clienteNome').value;
            const cCPF = document.getElementById('clienteCPF').value;
            const cEmail = document.getElementById('clienteEmail').value;
            const cEnd = document.getElementById('clienteEndereco').value;
            let dadosClienteHtml = '';
            
            if (cNome || cCPF) {
                dadosClienteHtml = `
                    <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #94a3b8; border-radius: 6px; background: #f8fafc;">
                        <div style="font-size: 11px; font-weight: bold; color: #475569; text-transform: uppercase; margin-bottom: 8px;">DADOS DO CLIENTE</div>
                        <table style="width:100%; border:none; margin:0;">
                            <tr>
                                <td style="padding:2px; font-size:11px;"><strong>Nome:</strong> ${cNome || '-'}</td>
                                <td style="padding:2px; font-size:11px;"><strong>CPF:</strong> ${cCPF || '-'}</td>
                            </tr>
                            <tr>
                                <td style="padding:2px; font-size:11px;"><strong>Email:</strong> ${cEmail || '-'}</td>
                                <td style="padding:2px; font-size:11px;"><strong>Endereço:</strong> ${cEnd || '-'}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }

            const prazoDias = prazo * 30;
            const aliqFixo = 0.0038;
            const aliqDiaria = 0.000082 * Math.min(prazoDias, 365);
            const iofTotal = aliqFixo + aliqDiaria;
            const financiadoBruto = (valorRaw + valorSeguro + valorExtra) / (1 - iofTotal);
            
            const pmtMain = calculatePMT(financiadoBruto, taxaRef / 100, prazo);
            const cetMain = calculateCET(valorRaw, pmtMain, prazo) * 100;
            
            const totalMain = pmtMain * prazo;
            const totalJuros = totalMain - financiadoBruto;
            const percJuros = (totalJuros / totalMain);

            const taxaMin = Math.max(0, taxaRef - 0.3);
            const taxaMax = taxaRef + 0.3;
            const pmtMin = calculatePMT(financiadoBruto, taxaMin/100, prazo);
            const pmtMax = calculatePMT(financiadoBruto, taxaMax/100, prazo);
            const totalMin = pmtMin * prazo;
            const totalMax = pmtMax * prazo;

            const bancosPrint = BANCOS_DATA.map(b => {
                let taxa = b.taxaBase;
                if (b.id === 'caixa' && recebeCaixa) taxa = b.taxaPromo;
                const pmtBanco = calculatePMT(financiadoBruto, taxa/100, prazo);
                const cetBanco = calculateCET(valorRaw, pmtBanco, prazo) * 100;
                return { ...b, taxa, pmt: pmtBanco, cet: cetBanco };
            }).sort((a,b) => a.cet - b.cet);

            const rowsHtml = bancosPrint.map((b, idx) => `
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 4px;"><strong>${b.nome}</strong></td>
                    <td style="padding: 4px; text-align: center;">${b.taxa.toFixed(2)}%</td>
                    <td style="padding: 4px; text-align: center;">${fMoney(b.pmt)}</td>
                    <td style="padding: 4px; text-align: right; color: ${idx===0 ? '#047857' : '#333'}; font-weight: bold;">${b.cet.toFixed(2)}%</td>
                </tr>
            `).join('');

            let badgeHtml = '';
            if (selectedBankId) {
                const bancoSel = BANCOS_DATA.find(b => b.id === selectedBankId);
                if (bancoSel) {
                    badgeHtml = `<div style="margin-top:5px; font-size:10px; background:#064e3b; color:#fff; padding:2px 6px; border-radius:4px; display:inline-block;">REF: ${bancoSel.nome}</div>`;
                }
            }

            let extrasHtml = '';
            if (usaExtras && valorExtra > 0) {
                extrasHtml = `
                <div class="sum-item">
                    <div class="sum-label" style="color:#b45309;">${nomeExtra}</div>
                    <div class="sum-val" style="color:#b45309; font-size:14px;">${fMoney(valorExtra)}</div>
                    <div class="variation">(Adicional)</div>
                </div>`;
            }
            
            let margemHtml = '';
            if (remunLiq > 0) {
                const isEstourado = pmtMain > margem35;
                const corStatus = isEstourado ? '#be123c' : '#047857';
                const statusTexto = isEstourado ? '❌ MARGEM EXCEDIDA' : '✅ DENTRO DA MARGEM';
                margemHtml = `
                <div class="sum-item" style="border-left: 1px solid #e5e7eb; padding-left: 10px;">
                    <div class="sum-label" style="color:${corStatus};">${statusTexto}</div>
                    <div class="sum-val" style="font-size:14px;">Renda: ${fMoney(remunLiq)}</div>
                    <div class="variation">Margem (35%): ${fMoney(margem35)}</div>
                </div>`;
            }

            const dicasPrintHtml = Object.values(DICAS_INFO).map(dica => `
                <div class="tip-box full-tip" style="margin-bottom: 15px; page-break-inside: avoid;">
                    <span class="tip-title" style="display:block; font-weight:bold; margin-bottom:5px; font-size:11px; border-bottom:1px solid #eee; padding-bottom:2px;">
                        ${dica.titulo}
                    </span>
                    <div class="tip-content" style="font-size: 10px; color: #444; line-height: 1.4;">
                        ${dica.texto}
                    </div>
                </div>
            `).join('');

            const conteudoPrint = `
                <html>
                <head>
                    <title>Orçamento_CET_ConsignadoGO_${dataFile}</title>
                    <style>
                        @page { size: A4; margin: 10mm; }
                        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding: 0; margin: 0; color: #333; line-height: 1.3; }
                        .header { padding-bottom: 10px; margin-bottom: 15px; border-bottom: 2px solid #047857; display: flex; justify-content: space-between; align-items: flex-end; }
                        .logo { font-size: 20px; font-weight: bold; color: #333; }
                        .logo span { color: #047857; }
                        .meta { text-align: right; font-size: 10px; color: #666; }
                        .summary-box { background: #f0fdf4; border: 1px solid #bbf7d0; padding: 10px; border-radius: 6px; margin-bottom: 15px; display: flex; justify-content: space-around; align-items: flex-start; flex-wrap: wrap; gap: 10px; }
                        .sum-item { text-align: center; min-width: 80px; }
                        .sum-label { font-size: 9px; text-transform: uppercase; color: #166534; font-weight: bold; margin-bottom: 2px;}
                        .sum-val { font-size: 16px; font-weight: bold; color: #14532d; }
                        .big-val { font-size: 22px; color: #16a34a; }
                        .variation { font-size: 8px; color: #666; margin-top: 4px; }
                        .variation span { display: block; }
                        h3 { margin-top: 15px; margin-bottom: 5px; font-size: 14px; border-left: 3px solid #0f172a; padding-left: 8px; }
                        table { width: 100%; border-collapse: collapse; font-size: 10px; margin-bottom: 10px; }
                        th { background: #f8fafc; text-align: left; padding: 4px; font-size: 9px; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
                        .tips-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                        .tip-box { background: #fff; border: 1px solid #e5e7eb; padding: 10px; border-radius: 4px; }
                        .footer-container { margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 15px; display: flex; justify-content: space-between; align-items: flex-end; }
                        .legal-text { text-align: left; font-size: 9px; color: #9ca3af; line-height: 1.4; max-width: 70%; }
                        .signature { text-align: right; font-size: 10px; color: #9ca3af; }
                        .fgc { color: #8B0000; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">Simulação <span>Consignado GO</span></div>
                        <div class="meta">Arquivo: Orçamento_CET_ConsignadoGO_${dataFile}<br>Ref: Servidor Público Estadual</div>
                    </div>
                    
                    ${dadosClienteHtml}

                    <div class="summary-box">
                        <div class="sum-item"><div class="sum-label">Valor Líquido</div><div class="sum-val">${valor}</div><div class="variation">Prazo: <strong>${prazo}x</strong></div></div>
                        <div class="sum-item"><div class="sum-label">Total Juros</div><div class="sum-val" style="color:#b91c1c;">${fMoney(totalJuros)}</div><div class="variation">Impacto: ${fPercent(percJuros)}</div></div>
                        ${extrasHtml}
                        <div class="sum-item"><div class="sum-label">Parcela Estimada</div><div class="sum-val big-val">${fMoney(pmtMain)}</div>${badgeHtml}<div class="variation"><span>Min (-0,3%): ${fMoney(pmtMin)}</span><span>Max (+0,3%): ${fMoney(pmtMax)}</span></div></div>
                        <div class="sum-item"><div class="sum-label">Total Pago</div><div class="sum-val">${fMoney(totalMain)}</div><div class="variation"><span>Min: ${fMoney(totalMin)}</span><span>Max: ${fMoney(totalMax)}</span></div></div>
                        ${margemHtml}
                    </div>

                    <h3>Ranking de Oportunidades (Simulado)</h3>
                    <table>
                        <thead><tr><th width="40%">Instituição</th><th width="20%" style="text-align: center;">Taxa Nominal</th><th width="20%" style="text-align: center;">Parcela</th><th width="20%" style="text-align: right;">Custo Real (CET)</th></tr></thead>
                        <tbody>${rowsHtml}</tbody>
                    </table>

                    <h3>Guia de Educação Financeira (Dicas Detalhadas)</h3>
                    <div class="tips-grid">
                        ${dicasPrintHtml}
                    </div>

                    <div class="footer-container">
                        <div class="legal-text">Este documento é uma simulação preliminar para fins de consultoria e não possui valor contratual.<br>As taxas podem variar conforme análise de crédito (score), margem disponível e convênio vigente.</div>
                        <div class="signature">desenvolvido por <span class="fgc">FGC</span><br><span style="font-weight:normal; letter-spacing:0;">fernandocortes@ueg.br</span></div>
                    </div>
                </body>
                </html>
            `;

            // IMPLEMENTAÇÃO DE IMPRESSÃO VIA IFRAME (Funciona no Mobile)
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = '0';
            document.body.appendChild(iframe);

            const doc = iframe.contentWindow.document;
            doc.open();
            doc.write(conteudoPrint);
            doc.close();

            // Aguarda renderização e imprime
            setTimeout(() => {
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
                // Remove o iframe após a impressão (timeout maior para garantir que o diálogo abriu)
                setTimeout(() => {
                    document.body.removeChild(iframe);
                }, 2000);
            }, 500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            const inputs = ['valorLiquido', 'prazo', 'taxaRef', 'valorSeguro', 'valorExtra', 'nomeExtra', 'remuneracaoLiquida'];
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.addEventListener('input', () => {
                        if(id !== 'nomeExtra' && id !== 'remuneracaoLiquida') selectedBankId = null; 
                        update();
                    });
                }
            });
            
            document.getElementById('checkCaixa').addEventListener('change', update);
            document.getElementById('checkSeguro').addEventListener('change', () => {
                if(document.getElementById('checkSeguro').checked) {
                    const val = parseFloat(document.getElementById('valorLiquido').value) || 0;
                    document.getElementById('valorSeguro').value = (val * 0.05).toFixed(2);
                }
                update();
            });
            document.getElementById('checkExtras').addEventListener('change', () => {
                update();
            });
            
            // Lógica de Incremento Dinâmico (Shift/Ctrl)
            const valorInput = document.getElementById('valorLiquido');
            function updateStep(e) {
                if (e.shiftKey) valorInput.step = 1000;
                else if (e.ctrlKey) valorInput.step = 1;
                else valorInput.step = 100;
            }
            window.addEventListener('keydown', updateStep);
            window.addEventListener('keyup', updateStep);

            renderSites();
            update();
        });
    </script>

</body></html>
